<app-content>
  <section class="section" *ngIf="isFormPageInitialized">
    <div class="row">
      <div class="col-lg-7">
        <div class="ibox ">
          <div class="ibox-title">
            <h4 *ngIf="id < 1">Add New Enrolment</h4>
            <h4 *ngIf="id > 0">Edit Enrolment</h4>
          </div>
          <div class="ibox-content">
            <div class="row">
              <div class="col-sm-12">
                <div class="section-body" *ngIf="isloaded">
                  <form [formGroup]="enrolmentPageFormGroup">
                    <div class="row">
                      <div class="col-12">
                        <div class="card-body">
                          <div class="form-group row">
                            <label for="name" class="col-4 col-form-label">Full Name</label>
                            <div class="col-10">
                              <input type="text" class="form-control" formControlName="name" id="name"
                                     pattern="^([A-Za-z]+ )+[A-Za-z]+$|^[A-Za-z]+$" autofocus
                                     [ngclass]="{ 'is-invalid': f.name.invalid && (f.name.touched || f.name.dirty) }">
                              <p-message severity="error"
                                         text="Name is required, Please enter a valid name with a maximum of 150 characters"
                                         *ngIf="f.name.invalid && (f.name.touched || f.name.dirty)">
                              </p-message>
                            </div>
                          </div>

                          <div class="form-group row">
                            <label for="employeeId" class="col-4 col-form-label">Employee ID</label>
                            <div class="col-10" *ngIf="id < 1">
                              <input type="text" class="form-control" formControlName="employeeId" id="employeeId"
                                     ng-pattern-restrict="^([A-Za-z0-9]{0,})$" [ngClass]="{ 'is-invalid': f.employeeId.invalid && (f.employeeId.touched || f.employeeId.dirty) }">
                              <p-message severity="error" text="Employee ID is required" *ngIf="f.employeeId.invalid && (f.employeeId.touched || f.employeeId.dirty)"></p-message>
                            </div>
                            <div class="col-10 form-control-plaintext" *ngIf="id > 0">
                              {{f.employeeId.value}}
                            </div>
                          </div>

                          <div class="form-group row">
                            <label for="role" class="col-4 col-form-label">Role Name</label>
                            <div class="col-10">
                              <p-dropdown [options]="roles" formControlName="role" filter="true"
                                          [style]="{'width': '100%'}"
                                          [ngclass]="{ 'is-invalid': f.role.invalid && (f.role.touched || f.role.dirty) }">
                              </p-dropdown>
                              <p-message severity="error" text="Role Name is required"
                                         *ngIf="f.role.invalid && (f.role.touched || f.role.dirty)">
                              </p-message>
                            </div>
                          </div>

                          <div class="form-group row">
                            <label for="permitTimeMinute" class="col-4 col-form-label">Permit-Time-Minute</label>
                            <div class="col-10">
                              <p-dropdown [options]="permitTimeMinutes" formControlName="permitTimeMinute" filter="true"
                                          [style]="{'width':'100%'}"
                                          [ngClass]="{ 'is-invalid': f.permitTimeMinute.invalid && (f.permitTimeMinute.touched || f.permitTimeMinute.dirty)}">

                              </p-dropdown>
                              <p-message severity="error" text="Permit Time Minute is required"
                                         *ngIf="f.permitTimeMinute.invalid && (f.permitTimeMinute.touched || f.permitTimeMinute.dirty)">

                              </p-message>
                            </div>
                          </div>

                          <div class="form-group row">
                            <label for="dateOfBirth" class="col-4 col-form-label">Date Of Birth</label>
                            <div class="col-10">
                              <p-calendar formControlName="dateOfBirth" [readonlyInput]="false" placeholder="mm/dd/yyyy"
                                          [monthNavigator]="true" [yearNavigator]="true" [yearRange]="enrolerDobYearRange"
                                          [maxDate]="enrolerDobMaxDate" [style]="{'width':'100%'}" [inputStyle]="{'width':'100%'}"
                                          [ngClass]="{ 'is-invalid': f.dateOfBirth.invalid && (f.dateOfBirth.touched || f.dateOfBirth.dirty)}">
                              </p-calendar>
                              <p-message severity="error" text="Date of Birth is required"
                                         *ngIf="f.dateOfBirth.invalid && (f.dateOfBirth.touched || f.dateOfBirth.dirty)">
                              </p-message>
                            </div>
                          </div>

                          <div class="form-group row">
                            <label for="mobileNumber" class="col-4 col-form-label">Mobile Number</label>
                            <div class="col-10">
                              <p-inputMask formControlName="mobileNumber" id="mobileNumber" mask="(999) 999-9999"
                                           unmask="true" [style]="{'width': '100%'}"
                                           [ngclass]="{ 'is-invalid': f.mobileNumber.invalid && (f.mobileNumber.touched || f.mobileNumber.dirty) }">
                              </p-inputMask>
                              <p-message severity="error"
                                         text="Please Enter a valid Mobile Number, Mobile Number must be a 10-digit valid mobile number."
                                         *ngIf="f.mobileNumber.invalid && (f.mobileNumber.dirty || f.mobileNumber.touched)">
                              </p-message>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-5">
        <div class="ibox ">
          <div class="ibox-title">
            <h5>Face Enrolment</h5>
          </div>
          <div class="ibox-content">
            <div class="row">
              <div class="col-sm-12">
                <div class="section-body" *ngIf="isloaded">
                  <form [formGroup]="enrolmentPageFormGroup">
                    <div class="col-lg-12">

                      <div class="alert alert-danger" *ngIf="!isMediaStreamSupported">
                        <div class="alert-title">
                          <h3>Error accessing camera</h3>
                        </div>
                        This page requires Face Recognition based enrolment of the user. However, there was an error trying to access the camera on this computer, please enable your system camera! then only you can capture the face.
                      </div>

                      <div class="card-header-action" *ngIf="isMediaStreamSupported">
                        <button class="btn btn-outline btn-outline-info" (click)="captureFace()">
                          <i class="fa fa-camera"></i> Capture Face
                        </button> &nbsp;
                      </div>
                      <div class="card-body">
                        <app-face-enrolment #enrolment [(faceImages)]="faceImages" [(isFaceCaptured)]="isFaceCaptured" [enableDelete]="enableDelete"
                                            (acceptSaveResult)="reload()" (faceImagesChange)="onFaceImagesChange($event)" [isSaveCompleted]="isSaveCompleted" [faceEnrolmentResult]="faceEnrolmentResult">
                        </app-face-enrolment>
                        <p-confirmDialog [style]="{width: '50vw'}" appendTo="body"></p-confirmDialog>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-12 bg-light text-right p-3">
        <button class="btn btn-primary" (click)="saveEnrolmentPage()" [disabled]="enrolmentPageFormGroup.invalid">
          Submit
        </button>
      </div>
    </div>
  </section>
</app-content>
